<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset=iso-8859-1" >
    <link rel="stylesheet" type="text/css" href="../../handlebar/gqbuttons.css" />
    <link rel="stylesheet" type="text/css" href="<TMPL_VAR name="STYLESHEET">" />
    <style xmlns="" type="text/css">
    <!-- /* Put overrides in here! */
    -->
    </style>
    <TMPL_INCLUDE NAME="date_picker.tmpl">
    <title><TMPL_VAR name="PAGE_TITLE"> - Report Maker</title>
</head>
<!--
#	HTML template for GenQuery running on EnvBase
#	Tim Booth Dec 2005.
#
#	After public_catalogue.php		J.Wood 11/8/04
#       NERC Environmental Bioinformatics Centre
#       http://nebc.nerc.ac.uk
-->

<!-- Banner -->
<div id="topbanner">
    <TMPL_VAR name="NAVBANNER">
<div id="logodiv_top"><!--Container for logo - see CSS--></div>
<h1><TMPL_IF name="PAGE_DESC"><TMPL_VAR name="PAGE_DESC"> - </TMPL_IF>Generate Reports</h1>

</div>

<div id="mainsection">
<!--Show either the section title or a welcoming message-->
<TMPL_IF NAME="SHOWING_TOP_MENU">
    <h2>Choose a report category or enter code for quick query</h2>

<TMPL_ELSE>
    <h2><TMPL_VAR NAME="MENU_TITLE"></h2>
</TMPL_IF>


<!-- Also try out the tree-view mode at the same time - w00t -->
<table class="formtable">
<form method="POST"  action='#query'>
<!--This pulls in all the required hidden fields -->
<TMPL_VAR NAME="MENU_AND_CONNECTION_STATE">
<TMPL_LOOP NAME="PARENT_MENUS">
    <!-- Show the parent item -->
    <tr align="left" valign="center">
	<td> <b><TMPL_VAR NAME="MENU_ITEM_NAME"></b> </td>
	<td> <!--This will generate something like: 
		 <input type="image" style="gq_submit_1" alt="go">
	     --> 
	    <TMPL_VAR NAME="MENU_ITEM_SUBMIT"> 
	</td>
    </tr>
    <!-- Show all children in a nested loop -->
    <TMPL_LOOP NAME="CHILD_MENUS">
	<!--This pulls in all the required hidden fields -->
	<!-- TODO - indent properly, kill table if poss -->
	<TMPL_VAR NAME="MENU_ITEM_PARAMS">
	<tr align="left" valign="center">
	    <td colspan="2"> &nbsp;&nbsp;<TMPL_VAR NAME="MENU_ITEM_NAME"> </td>
	    <td style="padding:0px"> <!--This will generate something like: 
		     <input type="image" style="gq_submit_1" alt="go">
		 --> 
		<TMPL_VAR NAME="MENU_ITEM_SUBMIT"> 
	    </td>
	</tr>
    </TMPL_LOOP>
</TMPL_LOOP>
</form>
</table>

<TMPL_UNLESS NAME="SHOWING_QUERY">
<h4>or</h4>

    <table class="formtable">
    <form method="GET"  action='query_barcodes.cgi' name='queryform'>
	<tr><td><input type="text" name="bc"  /></td> 
	    <td><input type="submit" name=".submit" value="Quick Query" /></td></tr>
    </form>
    </table>
    <script type='text/javascript'>
	   var bcbox = document.queryform.bc;
	       bcbox.focus();
	       bcbox.select();
    </script>
</TMPL_UNLESS>
    
<!-- Now the actual input form -->
<!-- Note that for zero-input queries the CGI jumps straight to the results but if
     the query appears on the results page you can still see the prompt. -->

<TMPL_IF NAME="SHOWING_QUERY">
<a name="query"></a>
<TMPL_IF NAME="QUERY_PARAM_COUNT">

    <h2><TMPL_VAR NAME="QUERY_TITLE"></h2>

    <p><b><TMPL_VAR NAME="QUERY_LABEL"></b></p>

    <!-- Query form is generated by the Perl.  Is this acceptable? Better be. -->
    <form method="POST" action="#results">
	<table class="formtable" />
	     <TMPL_LOOP NAME="QUERY_PARAMS">
                <tr><td>
                    <span class="gq_form_label">
                    <TMPL_VAR NAME="QUERY_PARAM_LABEL">
                    </span>
                </td><td>
                    <TMPL_VAR NAME="QUERY_PARAM_CONTROL">
                </td>
                </tr>
            </TMPL_LOOP>
            <tr><td colspan="2" style="text-align:right">
            <TMPL_VAR NAME="QUERY_FORM_SUBMIT">
            </tr></td>
	</table>
    </form>
</TMPL_IF>
</TMPL_IF>

<!-- Now the results -->

<TMPL_IF NAME="SHOWING_RESULTS">
    <a name="results"></a>

    <h2>Results of <TMPL_VAR NAME="QUERY_TITLE"></h2>
    
    <div style="padding:5px"><i>Records returned: <TMPL_VAR NAME="ROWS_RETURNED"></i></div>

   <TMPL_IF NAME="LINKOUT_TARGET">
       <form method="POST" action='<TMPL_VAR NAME="LINKOUT_TARGET">'>
   </TMPL_IF>
    
    <!-- Set table styles by CSS references to htable -->
    <TMPL_IF NAME="ROWS_RETURNED">
	<table class="neat1" bgcolor="#EEEEEE">
	    <!-- <TH><font size=-1 color="#666666">Name</font></TH> -->
	    <tr align="left" valign="top"><TMPL_VAR NAME="RESULTS_TABLE_HEADER"></tr>
	   
	    <TMPL_LOOP name="RESULTS_TABLE_ROW">
		<tr align="left" valign="top"><TMPL_VAR NAME="ROW_DATA"></tr>
	    </TMPL_LOOP>
	</table>
    </TMPL_IF>

    <TMPL_IF NAME="LINKOUT_TARGET">
    <p><TMPL_VAR NAME="LINKOUT_SUBMIT"></p>
        </form>
    </TMPL_IF>


    <p><b><a href='<TMPL_VAR NAME="PERMALINK">'>Permalink for this query</a></b></p>
    <p><b><a href='<TMPL_VAR NAME="DOWNLOADLINK">'>Download as CSV</a></b></p>
    <!-- <h3><a href='<TMPL_VAR NAME="DOWNLOADLINK">;fmt=xml'>Download as XML</a></h3> -->

    <TMPL_IF NAME="DEBUGLINK">
        <!--Debugging mode for developers-->
	<p><b><a href='<TMPL_VAR NAME="DEBUGLINK">'>Run this query in debug mode</a></b></p>
    </TMPL_IF>
</TMPL_IF>
      
</div>
<TMPL_VAR name="CUSTOM_FOOTER">

</body>
</html>
